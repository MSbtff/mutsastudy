# DNS와 작동원리

## DNS란?

도메인 네임 시스템(Domain Name System, DNS)은 호스트의 도메인 이름을 호스트의 네트워크 주소로 바꾸거나 그 반대의 변환을 수행할 수 있도록 하기 위해 개발되었다. 

즉 우리가 브라우저 주소창에 www.naver.com 이라 입력하지만 실제 서버는 숫자로 구성된 ip주소로 통신하고, 우리는 기억하기 쉬운 도메인 이름을 사용하는 과정에서 도메인주소를 숫자 주소인 ip로 바꾸는 시스템을 DNS라 한다.

## 구성요소

### 도메인 네임 공간(Domain Name Space) 과 리소스 레코드(Resource Recodrd)

도메인 네임 시스템에서 사용할 데이터 자료구조를 정의하는 사항에 해당한다. 도메인 네임 공간은 도메인 이름이 중복되지 않게 생성하여 사용하도록 정의된 구성 체계로 흔히 최상위에 루트 도메인으로 부터 뻗어나가는 트리 구조의 도메인 네임 체계가 이에 해당하고 도메인 네임 시스템에서 하나의 도메인 네임은 유일한 값을 갖는다.

리소스 레코드는 도메인 네임을 설정할 수 있는 데이터 타입으로 도메인 네임을 키값으로 하여 이를 데이터로 설정하는데 이때 사전에 약속된 데이터 타입과 포맷으로 적용해야하는데 이것이 리소스 레코드이다.
예를 들어 IPv4와 A타입 레코드 등이 있다.

인터넷을 일정한 공간으로 가정했을 때, 도메인이란 호스트에 대한 책임과 권한의 영역으로 물리적 실체인 **호스트** 관리하는 조직의 경계이다.

#### 루트 도메인 (Root Domain)
네임 스페이스에서 이름 해석의 출발지 역할을 수행하는 노드(서버)
최상위 도메인 서버의 정보를 가지고 있다.

전 세계에 13개의 원본 root 서버가 존재 (http://www.iana.org/domains/root/servers)

#### 최상위 도메인 (Top Level Domain = TLD)
국가 코드 최상이 도메인 (ccTLD : country code TLD)
.kr, .jp 등
일반 최상위 도메인 (gTLD = global TLD)
.net, .com, org 등
ARPA : 역방향 조회 시 사용되는 최상위 도메인
in-addr.arpa
#### 2차 도메인 (Second Level Domain, Sub Domain)
TLD 하위에서 관리되는 서브 도메인
국가 도메인 하위에 기관 유형에 따른 분류
.co (일반회사), .ac (교육기관), .go (정부기관) 등
#### 서브 도메인 (Sub Domain)
상위 도메인에 소속되는 각 기관 또는 회사별 도메인
ex : google, naver 등
하위 노드는 무한정 만들 수 있지만 주소를 이룰 수 있는 문자 수에 제한이 있다 (255byte).

1. 거대한 분산 네이밍 시스템

2. 계층적 구조

<img src="https://t1.daumcdn.net/cfile/tistory/2316A93F51C462940C">

---

### 네임 서버(Name Server)

네임서버는 도메인의 데이터를 보유하고, 외부 인터넷으로부터 도메인 네임과 그에대한 데이터 질의를 수신했을 때, 보유한 데이터를 검색하여 응답하는 역할을 담당하도록 구현한 서버 프로그램으로 여기에서 도메인 존(영역) 만 설정하고 리커시브 기능을 갖지 않는 순수한 네임서버를 의미한다.

즉 도메인 이름을 IP주소로 변환하고 리졸버로부터 요청받은 도메인이름에 대한 IP주소를 다시 리졸버로 전달해주는 역할이다.



#### 존 파일(Zone file)

특정 정보나 서비스를 제공하는 호스트(서버)에 접속하기 위해서 그 영역의 정보 즉 존 파일을 가지고 있는 네임서버로 우선 접근해야 한다.
인터넷에서 최종적으로 정보를 제공하는 것은 영역(Domain)이 아닌 특정 서버이므로 개별 호스트들의 정보를 가진, 즉 존 파일을 저장하고 있는 도메인 네임서버에 우선 접근해야 한다.

<img src="http://library.gabia.com/wp-content/uploads/2016/09/%ED%98%B8%EC%8A%A4%ED%8A%B8-%EB%84%A4%EC%9E%84%EC%84%9C%EB%B2%84-%EA%B7%B8%EB%A6%AC%EA%B3%A0-%EC%A1%B4%ED%8C%8C%EC%9D%BC.png">

1. 네임서버 및 관리자 정보
2. 호스트 주소 정보
3. 이메일 호스트 정보

---

### 리졸버 (Resolver)

리졸버는 도메인 네임의 데이터 조회기능을 수행하는 SW 라이브러리 형태의 루틴으로 도메인 네임과 조회대상 레코드 타입을 받아 인터넷 상에서 해당 도메인이 설정되어 있는 서버를 자동으로 추적 탐색하여 최종 결과를 주는 기능으로 도메인 네임 시스템이 분산방식으로 산재하여 이를 조회하기 위해 리졸버가 필요하다.

현재 인터넷에서의 리졸버는 DNS 질의 응답과 트래픽의 질감 및 효율성을 위해 데이터 캐싱 기능을 갖는 별도의 시스템인 리커시브 네임서버로 주로 구현하여 구성하고 있다.

<img src="https://t1.daumcdn.net/cfile/tistory/994D08335A296B1318">


## DNS 작동원리 

표면적으로 홈페이지(www)라는 관문을 통해 연결되어 있는 각종 서비스를 이용하지만 사실은 www서버, 메일 서버, 도메인 서버, 호스팅 서버가 서비스를 제공하는 것으로 각 서버들의 정보(ip와 서버 이름)을 가지고 있는 도메인 네임서버가 작동하는 것이다.

예를 들어 www.gabia.com은 

1. www는 호스트 이름
2. gabia는 호스트 관리 기관 영역
3. com은 최상위 영역

<img src="http://library.gabia.com/wp-content/uploads/2016/09/DNS-%EC%9E%91%EB%8F%99-%EB%B0%A9%EC%8B%9D.png">

#### 루트 네임서버

Root DNS는 인터넷의 도메인 네임 시스템의 루트 존으로 루트존의 레코드 요청에 직접 응답하고 적절한 최상위 도메인에 대한 권한이 있는 네임서버 목록을 반환함으로써 요청에 응답한다.

---

1. 웹 브라우저에 www.gabia.com을 입력하면 먼저 Local DNS에게 www.gabia.com 이라는 hostname에 대한 ip 주소를 질의하여 Local DNS에 없으면 다른 네임서버 정보를 받는데 이때 Root DNS(루트 네임서버)정보를 전달받는다

2. Root DNS 서버에 www.gaiba.com 질의

3. Root DNS 서버로부터 com 도메인을 관리하는 TLD(Top-Level domain)이름 서버 정보 전달 받는다.

4. TLD에 www.gabia.com 질의
5. TLD에서 gaiba.com 관리하는 DNS정보 전달
6. gaiba.com 도메인을 관리하는 DNS 서버에 www.gabia.com 호스트네임에 대한 ip 주소 질의
7. Local DNS 서버에게 IP 211.115.83.234 응답
8. Local DNS는 www.gabia.com에 대한 ip주소를 캐싱하고 정보 전달

만약 최근 방문 기록에 www.gabia.com있을시 호스트 정보를 가지고 곧 바로 gabia의 www서버를 찾아 접속이 가능하고 이러한 것을 캐시 서버라 하여 즉시 응답할 수 있도록 하는 역할을 합니다.

이 네임서버는 모든 영역을 관리하는 ICANN(국제 인터넷주소 관리 기구)산하의 IANA가 있다.


